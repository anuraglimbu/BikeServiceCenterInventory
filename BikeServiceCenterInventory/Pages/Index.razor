@page "/"

@using BikeServiceCenterInventory.Models
@using BikeServiceCenterInventory.Services

@inject NavigationManager NavManager

@inject InventoryService Inventory
@inject RecordKeepingService Records
@inject AuthenticationService Auth

@if (CurrentUser == null)
{
	<p>Loading...</p>
}
else
{
	<h4 class="fw-bolder h4 text-center">Welcome to DocReview</h4>
	<center>
		<hr class="underline" style="width:5em;height:3px;opacity:1">
	</center>

	<div class="row">
		<div class="col-xl-8 col-lg-8 col-md-12 flex-column">

			<div class="accordion mb-3 shadow">
				<div class="accordion-item">
					<h2 class="accordion-header" id="summary-report-panel">
						<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#summary-report-panel-collapse" aria-expanded="true" aria-controls="summary-report-panel-collapse">
							<text class="fs-5"><span class="far fa-clipboard"></span></text> &nbsp; Inventory Management
						</button>
					</h2>
					<div id="summary-report-panel-collapse" class="accordion-collapse collapse show" aria-labelledby="summary-report-panel">
						<div class="accordion-body">
							<div class="row">
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/additem" class="accordion-link mb-2" title="Add New Item ">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="fas fa-truck-ramp-box"></span></text>
										</span>
										<span class="accordion-link-text">
											Add New Item
										</span>
									</a>
								</div>
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/restock" class="accordion-link" title="Restock Item">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="fas fa-cart-flatbed"></span></text>
										</span>
										<span class="accordion-link-text">
											Restock Item
										</span>
									</a>
								</div>
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/viewitems" class="accordion-link" title="View Inventory">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="fas fa-boxes-stacked"></span></text>
										</span>
										<span class="accordion-link-text">
											View Inventory
										</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="accordion mb-3 shadow">
				<div class="accordion-item">
					<h2 class="accordion-header" id="summary-report-panel">
						<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#summary-report-panel-collapse" aria-expanded="true" aria-controls="summary-report-panel-collapse">
							<text class="fs-5"><span class="fas fa-book"></span></text> &nbsp; Record Management
						</button>
					</h2>
					<div id="summary-report-panel-collapse" class="accordion-collapse collapse show" aria-labelledby="summary-report-panel">
						<div class="accordion-body">
							<div class="row">
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/approve" class="accordion-link mb-2" title="Approve">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="oi oi-task" aria-hidden="true"></span></text>
										</span>
										<span class="accordion-link-text">
											Approve
										</span>
									</a>
								</div>
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/viewrecords" class="accordion-link" title="View Records">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="fas fa-book-bookmark"></span></text>
										</span>
										<span class="accordion-link-text">
											View Records
										</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="accordion mb-3 shadow">
				<div class="accordion-item">
					<h2 class="accordion-header" id="summary-report-panel">
						<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#summary-report-panel-collapse" aria-expanded="true" aria-controls="summary-report-panel-collapse">
							<text class="fs-5"><span class="fas fa-magnifying-glass-chart"></span></text> &nbsp; Infographics
						</button>
					</h2>
					<div id="summary-report-panel-collapse" class="accordion-collapse collapse show" aria-labelledby="summary-report-panel">
						<div class="accordion-body">
							<div class="row">
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/stats" class="accordion-link" title="Profile Details">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="fas fa-chart-simple"></span></text>
										</span>
										<span class="accordion-link-text">
											Stats
										</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="accordion mb-3 shadow">
				<div class="accordion-item">
					<h2 class="accordion-header" id="summary-report-panel">
						<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#summary-report-panel-collapse" aria-expanded="true" aria-controls="summary-report-panel-collapse">
							<text class="fs-5"><span class="fa fa-user"></span></text> &nbsp; Profile Management
						</button>
					</h2>
					<div id="summary-report-panel-collapse" class="accordion-collapse collapse show" aria-labelledby="summary-report-panel">
						<div class="accordion-body">
							<div class="row">
								<div class="col-12 col-sm-6 accordion-item-link">
									<a href="/account" class="accordion-link" title="Profile Details">
										<span class="accordion-link-icon">
											<text class="fs-4"><span class="fa fa-address-card"></span></text>
										</span>
										<span class="accordion-link-text">
											Profile Details
										</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>

		<!-- Side Panel-->

		<div class="col-xl-4 col-lg-4 col-md-12">
			<div class="row g-3 row-deck">
				<div class="col-md-12 col-lg-12 col-xl-12">
					<div class="card bg-color-primary">
						<div class="card-body">
							<div class="d-flex align-items-center flex-fill">
								<span class="avatar icon bg-white rounded-circle text-center d-flex align-items-center justify-content-center">
									<i class="fas fa-warehouse fs-5 text-color-primary"></i>
								</span>
								<div class="d-flex flex-column ps-3  flex-fill">
										@if(TotalItems != null)
										{
											<h6 class="fw-bold mb-0 fs-4 text-white">@TotalItems</h6>
										}
										else
										{
											<h6 class="fw-bold mb-0 fs-4 text-white">Loading..</h6>
										}
									<span class="text-white">Total Items</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-12 col-lg-12 col-xl-12  flex-column">
					<div class="card mb-3">
						<div class="card-body">
							<div class="d-flex align-items-center flex-fill">
								<span class="avatar icon light-success-bg rounded-circle text-center d-flex align-items-center justify-content-center">
									<i class="fas fa-pallet fs-5 text-color-primary"></i>
								</span>
								<div class="d-flex flex-column ps-3  flex-fill">
									@if (OutOfStockItems != null)
									{
										<h6 class="fw-bold mb-0 fs-4 text-color-primary">@OutOfStockItems</h6>
									}
									else
									{
										<h6 class="fw-bold mb-0 fs-4 text-color-primary">Loading..</h6>
									}
									<span class="text-muted">Out of Stock</span>
								</div>
							</div>
						</div>
					</div>
					<div class="card">
						<div class="card-body">
							<div class="d-flex align-items-center flex-fill">
								<span class="avatar icon light-success-bg rounded-circle text-center d-flex align-items-center justify-content-center">
									<i class="fa fa-file-circle-check fs-5 text-color-primary"></i>
								</span>
								<div class="d-flex flex-column ps-3 flex-fill">
									@if (LastApprovedDate != null)
									{
										<h6 class="fw-bold mb-0 fs-4 text-color-primary">
											@LastApprovedDate.Value.ToShortDateString()
										</h6>
									}
									else
									{
										<h6 class="fw-bold mb-0 fs-4 text-color-primary">Loading..</h6>
									}
									<span class="text-muted">Last Approved</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-12 col-lg-12 col-xl-12">
					<div class="card">
						<div class="card-header py-3 d-flex justify-content-between bg-transparent border-bottom-0">
							<h6 class="mb-0 fw-bold ">General Information</h6>
						</div>
						<div class="card-body">
							<div class="flex-grow-1">
								<div class="py-2 d-flex align-items-center border-bottom flex-wrap">
									<div class="d-flex align-items-center flex-fill">
										<div class="avatar icon rounded-1 no-thumbnail table-badge-reviewing color-defult">
											<i class="fa fa-person text-color-primary fs-4"></i>
										</div>

										<div class="d-flex flex-column ps-3">
											<h6 class="fw-bold mb-0 small-14">@CurrentUser.FirstName @CurrentUser.LastName</h6>
											<span class="text-muted">Admin</span>
										</div>
									</div>
								</div>
								<div class="py-2 d-flex align-items-center  flex-wrap">
									<div class="d-flex align-items-center flex-fill">
										<div class="avatar icon rounded-1 no-thumbnail table-badge-reviewing color-defult">
											<i class="fa fa-at text-color-primary fs-4"></i>
										</div>
										<div class="d-flex flex-column ps-3">
											<h6 class="fw-bold mb-0 small-14">Username</h6>
											<span class="text-muted">@CurrentUser.UserName</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
}


@code {
	private Admin CurrentUser;
	private int? TotalItems;
	private int? OutOfStockItems;
	private DateTime? LastApprovedDate;

	[CascadingParameter]
	public AppState ApplicationState { get; set; }

	protected override async Task OnInitializedAsync()
	{
		if (await Auth.isLoggedIn())
		{
			CurrentUser = await Auth.getUser();

			var allItems = await Inventory.getAllItems();
			TotalItems = allItems.Count();
			OutOfStockItems = allItems.Where(item => item.Quantity == 0).Count();

			LastApprovedDate = await Records.getLastApprovedDateTime();

			ApplicationState.IsLoggedIn = true;
		}
		else
		{
			ApplicationState.IsLoggedIn = false;
		}
	}
}